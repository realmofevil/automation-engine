stages: [test, report]

test:
  #stage: test
  image: maven:3.9-eclipse-temurin-21
  script:
    - mvn test
  artifacts:
    paths:
      - allure-results

report:
  stage: report
  script:
    - mkdir -p allure-results/history
    - cp -r previous-allure/history allure-results/ || true
    - allure generate allure-results -o allure-report
  artifacts:
    when: always
    paths:
      - allure-report
      - allure-results






stages:
  - test
  - report

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"

cache:
  paths:
    - .m2/repository
    - target

run_automation:
  image: maven:3.9.6-eclipse-temurin-21
  stage: test
  script:
    - mvn clean test -Denv=dev -Dsuite=smoke
  artifacts:
    when: always
    paths:
      - target/allure-results

generate_report:
  stage: report
  image: frankescobar/allure-docker-service
  script:
    - allure generate target/allure-results -o target/site/allure-report
  artifacts:
    paths:
      - target/site/allure-report
    expire_in: 1 week